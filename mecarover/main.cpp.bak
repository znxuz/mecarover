#include <stdio.h>

#include <cmsis_os2.h>
#include <dma.h>
#include <gpio.h>
#include <main.h>
#include <mecarover/rtos_config.h>
#include <stm32f7xx_hal.h>
#include <tim.h>
#include <usart.h>
#include <lwip.h>

#include <mecarover/controls/MecanumControllerTask.h>
#include <mecarover/hal/stm_hal.hpp>
#include <mecarover/lidar/lidar.h>
#include <mecarover/micro_ros/micro_ros.hpp>
#include <mecarover/retarget.h>
#include <mecarover/robot_params.hpp>

LaserScanner ls;

using namespace imsl;
using namespace imsl::vehiclecontrol;

extern "C"
{

int main()
{
	osKernelInitialize();

	if (fz.type != MRC_VEHICLETYPE_MECANUM)
		log_message(log_error, "Vehicle type is not mecanum");
	auto* controller_task = new MecanumControllerTask<real_t>();
	controller_task->Init(&fz, Regler, Ta);
	ls.init_LaserScanner();

	xTaskCreate(micro_ros, "micro_ros", STACK_SIZE, controller_task,
				MICRO_ROS_TASK_PRIORITY, NULL);

	osKernelStart();
}
}
